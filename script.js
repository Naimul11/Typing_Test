document.addEventListener("DOMContentLoaded",(function(){loadNewWordSet(),document.getElementById("word-box").style.visibility="visible",displayLeaderboard(),document.getElementById("toggle-leaderboard").addEventListener("click",toggleLeaderboard)}));let interval,timer=60,isRunning=!1,correctWords=0,incorrectWords=0,totalCharactersTyped=0,wordIndex=0;function startTest(){isRunning=!0,interval=setInterval(updateTimer,1e3)}function updateTimer(){timer>0?(timer--,document.getElementById("timer").textContent=timer):(clearInterval(interval),document.getElementById("input-box").disabled=!0,showResults())}function checkWord(){const e=document.getElementById("word-box").textContent.split(/\s+/),t=document.getElementById("input-box").value.trim();if(t===e[wordIndex])totalCharactersTyped+=t.length+1,correctWords++,document.getElementById("correct-count").textContent=correctWords;else{const r=e[wordIndex];let o=0;for(let e=0;e<t.length;e++)t[e]===r[e]&&o++;if(totalCharactersTyped+=o,incorrectWords>20)return clearInterval(interval),document.getElementById("input-box").disabled=!0,alert("Too many mistakes! Please retry."),document.getElementById("result-text").textContent="Your WPM is NaN",void(document.getElementById("result-text").style.display="block");incorrectWords++,document.getElementById("incorrect-count").textContent=incorrectWords}wordIndex++,wordIndex>=e.length?loadNewWordSet():updateWordBox(e,!1)}function validateCurrentInput(e){const t=document.getElementById("word-box").textContent.split(/\s+/);updateWordBox(t,!t[wordIndex].startsWith(e))}function loadNewWordSet(){currentSet=generateRandomWords(8),updateWordBox(currentSet,!1),wordIndex=0}function generateRandomWords(e){const t=["apple","grape","happy","light","music","ocean","water","cloud","phone","mouse","train","green","black","white","river","chair","table","story","paper","money","brick","glass","plant","shirt","sound","spoon","bread","grill","skirt","jelly","piano","world","space","field","grass","tiger","horse","zebra","beach","storm","flame","smoke","sugar","lemon","melon","grape","chess","block","angle","frame","honey","snack","fruit","juice","swing","pride","cliff","daisy","toast","fence","spade","pearl","scent","lunar","novel","wagon","charm","carol","dough","swirl","frost","crown","badge","spark","flute","chill","coast","straw","blaze","glove","brave","serum","candy","hazel","slate","maple","petal","cocoa","ivory","trend","marsh","slope","coral","quest","drift","brisk","pouch","scarf","gloom","latch"];return Array.from({length:e},(()=>t[Math.floor(Math.random()*t.length)]))}function updateWordBox(e,t){document.getElementById("word-box").innerHTML=e.map(((e,r)=>`<span class="${r===wordIndex?t?"current-word incorrect":"current-word":""}">${e}</span>`)).join(" ")}function calculateWPM(){return Math.round(totalCharactersTyped/5/1)}function showResults(){let e=calculateWPM();document.getElementById("result-text").textContent=`Your WPM is ${e}`,document.getElementById("result-text").style.display="block",checkHighScore(e)}function checkHighScore(e){let t=JSON.parse(localStorage.getItem("leaderboard"))||[];if(t.length<3||e>t[t.length-1].score){let r=prompt("ðŸŽ‰ You made it to the leaderboard! Enter your name:");if(r){let o=document.getElementById("incorrect-count").textContent;t.push({name:r,score:e}),t.sort(((e,t)=>t.score-e.score)),t.length>3&&t.pop(),localStorage.setItem("leaderboard",JSON.stringify(t)),displayLeaderboard(),fetch("https://script.google.com/macros/s/AKfycbyWFEMnXydEmTw_MnjkTHdvtpBJZtQCF4MTKGyIQvP5bMd0NMlikCCcM3NqgQwQKg_VGA/exec",{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,wpm:e,incorrect:o})}).then((e=>console.log("Data sent successfully"))).catch((e=>console.error("Fetch Error:",e)))}}}function displayLeaderboard(){let e=JSON.parse(localStorage.getItem("leaderboard"))||[];document.getElementById("leaderboard").innerHTML="<h2>Leaderboard</h2>"+e.map(((e,t)=>`<p>${t+1}. ${e.name} - ${e.score} WPM</p>`)).join("")}function restartTest(){clearInterval(interval),document.getElementById("input-box").value="",document.getElementById("input-box").disabled=!1,document.getElementById("timer").textContent="60",correctWords=0,timer=60,incorrectWords=0,totalCharactersTyped=0,wordIndex=0,document.getElementById("correct-count").textContent="0",document.getElementById("incorrect-count").textContent="0",document.getElementById("result-text").style.display="none",loadNewWordSet(),isRunning=!1}function toggleLeaderboard(){const e=document.getElementById("leaderboard-container"),t=document.getElementById("toggle-leaderboard");"10px"===e.style.right?(e.style.right="-300px",t.style.right="-30px"):(e.style.right="10px",t.style.right="270px")}document.getElementById("input-box").addEventListener("input",(function(e){" "!==this.value?(isRunning||""===this.value.trim()||startTest(),""!==this.value.trim()&&" "===this.value.slice(-1)?(checkWord(),this.value=""):validateCurrentInput(this.value)):this.value=""})),document.getElementById("reset-leaderboard").addEventListener("click",(function(){localStorage.removeItem("leaderboard"),displayLeaderboard()}));
